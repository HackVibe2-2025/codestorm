<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeepScan - File Type Debug Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-area {
            background: white;
            border: 2px dashed #ccc;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            margin: 20px 0;
            transition: all 0.3s ease;
        }
        .test-area.dragover {
            border-color: #007bff;
            background: #f0f8ff;
        }
        .debug-output {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin: 20px 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <h1>🔍 DeepScan File Type Debug Test</h1>
    
    <div class="test-area" id="testDropZone">
        <h3>📁 Drag & Drop Test Zone</h3>
        <p>Drag any image file here to see detailed validation info</p>
        <input type="file" id="testFileInput" accept="image/*" multiple style="margin: 10px;">
    </div>
    
    <div>
        <h3>🧪 Test Functions</h3>
        <button class="test-button" onclick="runMimeTypeTest()">Test MIME Types</button>
        <button class="test-button" onclick="runExtensionTest()">Test Extensions</button>
        <button class="test-button" onclick="clearOutput()">Clear Output</button>
    </div>
    
    <div id="debugOutput" class="debug-output">
🔍 DEBUG OUTPUT - Drop files or use test buttons to see validation details...
    </div>

    <script>
        const debugOutput = document.getElementById('debugOutput');
        const testDropZone = document.getElementById('testDropZone');
        const testFileInput = document.getElementById('testFileInput');
        
        // Supported formats (same as main app)
        const supportedFormats = [
            'image/jpeg', 
            'image/jpg', 
            'image/png', 
            'image/webp', 
            'image/gif',
            'image/pjpeg',
            'image/x-png',
            'image/bmp',
            'image/tiff',
            'image/svg+xml',
            'image/x-bitmap',
            'image/x-ms-bmp',
            'image/vnd.microsoft.icon',
            'image/x-icon',
            'image/x-portable-bitmap',
            'image/x-portable-graymap',
            'image/x-portable-pixmap',
            '',
            'application/octet-stream'
        ];

        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            debugOutput.textContent += `[${timestamp}] ${message}\n`;
            debugOutput.scrollTop = debugOutput.scrollHeight;
        }

        function clearOutput() {
            debugOutput.textContent = '🔍 DEBUG OUTPUT - Ready for testing...\n';
        }

        function validateFile(file) {
            log(`\n🔍 VALIDATING FILE: ${file.name}`);
            log(`  📄 Name: ${file.name}`);
            log(`  🏷️  Type: "${file.type}"`);
            log(`  📏 Size: ${file.size} bytes`);
            log(`  📅 Modified: ${new Date(file.lastModified).toLocaleString()}`);
            
            // Test MIME type
            const mimeValid = supportedFormats.includes(file.type);
            log(`  🎯 MIME type valid: ${mimeValid ? '✅ YES' : '❌ NO'}`);
            
            // Test extension
            const validExtensions = ['.jpg', '.jpeg', '.png', '.webp', '.gif', '.bmp', '.tiff', '.svg'];
            const fileName = file.name.toLowerCase();
            const hasValidExtension = validExtensions.some(ext => fileName.endsWith(ext));
            log(`  🎯 Extension valid: ${hasValidExtension ? '✅ YES' : '❌ NO'}`);
            
            // Final result
            const isValid = mimeValid || hasValidExtension;
            log(`  🎯 FINAL RESULT: ${isValid ? '✅ ACCEPTED' : '❌ REJECTED'}`);
            
            return isValid;
        }

        // Drag and drop handlers
        testDropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            testDropZone.classList.add('dragover');
        });

        testDropZone.addEventListener('dragleave', (e) => {
            e.preventDefault();
            if (!testDropZone.contains(e.relatedTarget)) {
                testDropZone.classList.remove('dragover');
            }
        });

        testDropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            testDropZone.classList.remove('dragover');
            
            log('\n🎯 DRAG & DROP EVENT TRIGGERED');
            log(`  📁 Files count: ${e.dataTransfer.files.length}`);
            
            const files = Array.from(e.dataTransfer.files);
            files.forEach((file, index) => {
                log(`\n--- FILE ${index + 1} ---`);
                validateFile(file);
            });
        });

        // File input handler
        testFileInput.addEventListener('change', (e) => {
            log('\n🎯 FILE INPUT CHANGE EVENT');
            log(`  📁 Files count: ${e.target.files.length}`);
            
            const files = Array.from(e.target.files);
            files.forEach((file, index) => {
                log(`\n--- FILE ${index + 1} ---`);
                validateFile(file);
            });
        });

        // Test functions
        function runMimeTypeTest() {
            log('\n🧪 MIME TYPE TEST');
            const testTypes = [
                'image/jpeg',
                'image/jpg', 
                'image/png',
                'image/webp',
                'image/gif',
                'image/bmp',
                'image/tiff',
                '',
                'application/octet-stream',
                'text/plain',
                'video/mp4'
            ];
            
            testTypes.forEach(type => {
                const isSupported = supportedFormats.includes(type);
                log(`  "${type}" → ${isSupported ? '✅ SUPPORTED' : '❌ NOT SUPPORTED'}`);
            });
        }

        function runExtensionTest() {
            log('\n🧪 EXTENSION TEST');
            const testFiles = [
                'photo.jpg',
                'photo.jpeg',
                'image.png',
                'picture.webp',
                'animation.gif',
                'bitmap.bmp',
                'document.pdf',
                'video.mp4',
                'photo.JPG',
                'IMAGE.PNG'
            ];
            
            const validExtensions = ['.jpg', '.jpeg', '.png', '.webp', '.gif', '.bmp', '.tiff', '.svg'];
            
            testFiles.forEach(fileName => {
                const lowerName = fileName.toLowerCase();
                const hasValidExt = validExtensions.some(ext => lowerName.endsWith(ext));
                log(`  "${fileName}" → ${hasValidExt ? '✅ VALID' : '❌ INVALID'}`);
            });
        }

        // Initial log
        log('🔍 Debug test page loaded successfully');
        log(`📋 Supported MIME types: ${supportedFormats.length} types`);
        log('📁 Ready for file testing...');
    </script>
</body>
</html>
